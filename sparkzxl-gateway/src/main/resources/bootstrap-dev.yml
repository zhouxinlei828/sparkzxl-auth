server:
  shutdown: graceful
  port: 8800
spring:
  application:
    name: sparkzxl-gateway-resilience4j
  codec:
    max-in-memory-size: 100MB
  cloud:
    nacos:
      discovery:
        server-addr: 47.114.40.129:8848
        namespace: 41618410-b6bb-40ba-99cf-f2c8d2fe4da0
      config:
        server-addr: 47.114.40.129:8848
        namespace: 41618410-b6bb-40ba-99cf-f2c8d2fe4da0
        file-extension: yaml
        prefix: ${spring.application.name}
        shared-configs:
          - dataId: redis.yaml
            group: DEFAULT_GROUP
            refresh: true
          - dataId: common.yaml
            group: DEFAULT_GROUP
            refresh: true
          - dataId: resilience4j.yaml
            group: DEFAULT_GROUP
            refresh: true
        enable-remote-sync-config: true
        refresh-enabled: true
resilience4j.circuitbreaker:
  configs:
    default:
      slidingWindowSize: 10 #滑动窗口大小
      registerHealthIndicator: true #是否注册到健康监测
      minimumNumberOfCalls: 5
      permittedNumberOfCallsInHalfOpenState: 3
      automaticTransitionFromOpenToHalfOpenEnabled: true #如果置为 true，当等待时间结束会自动由打开变为半开；若置为 false，则需要一个请求进入来触发熔断器状态转换。默认为 true
      waitDurationInOpenState: 5000 # 熔断器从打开状态转变为半开状态等待的时间，单位：微秒
      failureRateThreshold: 50 #熔断器关闭状态和半开状态使用的同一个失败率阈值，单位：百分比。默认为 50
      eventConsumerBufferSize: 10 #事件缓冲区大小
      recordExceptions:
        - org.springframework.web.client.HttpServerErrorException
        - java.io.IOException
      ignoreExceptions:
        - java.lang.IllegalStateException
    shared:
      slidingWindowSize: 100
      permittedNumberOfCallsInHalfOpenState: 30
      waitDurationInOpenState: 1s
      failureRateThreshold: 50
      eventConsumerBufferSize: 10
      ignoreExceptions:
        - java.lang.IllegalStateException
  instances:
    backendA:
      baseConfig: default
    backendB:
      slidingWindowSize: 10
      minimumNumberOfCalls: 10
      permittedNumberOfCallsInHalfOpenState: 3
      waitDurationInOpenState: 1s
      failureRateThreshold: 50
      eventConsumerBufferSize: 10
      ringBufferSizeInClosedState: 5 # 熔断器关闭状态的缓冲区大小，不会限制线程的并发量，在熔断器发生状态转换前所有请求都会调用后端服务。默认为 100
resilience4j.retry:
  configs:
    default:
      max-retry-Attempts: 3 # 最大重试次数。包括第一次调用,默认为 3
      wait-duration: 5s # 下次重试的间隔，单位：微秒。默认为 500 毫秒
      retry-exceptions: # 需要重试的异常列表。默认为空
      ingore-exceptions: # 需要忽略的异常列表。默认为空
  instances:
    backendA:
      maxRetryAttempts: 3
      waitDuration: 10s
      enableExponentialBackoff: true # 启用随机等待时间，范围是 waitDuration - randomizedWaitFactor*waitDuration ~ waitDuration + randomizedWaitFactor*waitDuration
      exponentialBackoffMultiplier: 2
      retryExceptions:
        - org.springframework.web.client.HttpServerErrorException
        - java.io.IOException
      backendB:
        maxRetryAttempts: 3
        waitDuration: 10s
        retryExceptions:
          - org.springframework.web.client.HttpServerErrorException
          - java.io.IOException
resilience4j.thread-pool-bulkhead:
  configs:
    default:
      maxThreadPoolSize: 50
      coreThreadPoolSize: 10
      queueCapacity: 1000